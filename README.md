# ParkingHub
[![CI](https://github.com/taatolu/ParkingHub/actions/workflows/ci.yml/badge.svg)](https://github.com/taatolu/ParkingHub/actions/workflows/ci.yml)


## 概要
ParkingHubは、会社駐車場の利用者（社員・協力業者・外注業者）および車両管理、違反記録、許可証発行、注意文書作成などを効率化するWebシステムです。従来のExcel管理から脱却し、社内サーバ上のDocker環境で安定運用します。

★本アプリはクリーンアーキテクチャとTDDの方針で開発します★

---

## システム構成

- **フロントエンド**: React（TypeScript）SPA  
- **バックエンド**: Golang（REST API）  
- **データベース**: PostgreSQL  
- **インフラ**: すべてDockerコンテナで社内サーバ上に構築  
- **アクセス**: 社内ネットワークのみ

---

## 主な機能

- **利用者（User）管理**
  - システムへのログイン・権限管理
  - 情報参照・編集

- **車両所有者（CarOwner）管理**
  - 車両の所有者

- **車両管理**
  - CRUD
  - 車両ごとに所有者（CarOwner）を設定


- **違反記録管理**
  - 違反種別ごとに記録
  - 累積違反数管理
  - 始末書提出要否自動判定

- **許可証発行**
  - 利用者区分ごとにPDF出力・印刷

- **注意文書作成**
  - 違反内容に応じた文書自動生成（メール・貼紙用）

- **CSVインポート**
  - 利用者・車両・違反記録の一括登録/更新

- **ユーザー・権限管理**
  - 管理者：全データ操作
  - 一般利用者：自分の情報参照・一部編集

---

## 画面レイアウト（主要画面）

- **ログイン画面**：ユーザーID／パスワード入力、エラーメッセージ表示
- **ダッシュボード**：各管理画面へのリンク、期限切れ・違反累積アラート
- **社員・業者管理**：一覧・検索・詳細・編集・削除・新規登録、CSVインポート
- **車両管理**：一覧・検索・詳細・編集・削除・新規登録、CSVインポート
- **違反記録管理**：一覧・検索・詳細・編集・削除・新規登録、CSVインポート
- **許可証発行**：利用者選択／許可証種別選択／有効期限設定／PDF発行
- **注意文書作成**：利用者・違反内容選択／文書自動生成／メール送信・印刷
- **CSVインポート**：ファイル選択／インポート実行／結果表示

---

## API仕様（主要エンドポイント）

- 認証：JWTトークン（Authorization: Bearer ）
- レスポンス：JSON

| メソッド | パス | 概要 | 権限 |
|----------|------|------|------|
| POST | /api/login | ログイン | － |
| GET | /api/users | システム利用者一覧取得 | 管理者 |
| POST | /api/users | システム利用者新規登録 | 管理者 |
| GET | /api/car_owners | 車両所有者一覧取得 | 管理者 |
| POST | /api/car_owners | 車両所有者新規登録 | 管理者 |
| GET | /api/vehicles | 車両一覧取得 | 管理者 |
| POST | /api/vehicles | 車両新規登録 | 管理者 |
| ... | ... | ... | ... |
| POST | /api/permits | 許可証発行 | 管理者 |
| POST | /api/notices | 注意文書生成 | 管理者 |
| POST | /api/import/csv | CSVインポート | 管理者 |

---

## ER図（テキスト表現）

```
[users] 1 --- n [vehicles]
[car_owners] 1 --- n [vehicles]
[vehicles] n --- 1 [car_owners]
[users] 1 --- 1 [licenses]
[users] 1 --- n [violations]
[users] 1 --- n [permits]
[vehicles] 1 --- n [violations]
```

- users（システム利用者：ログイン・操作権限のみ）
- car_owners（車両所有者：所有権管理のみ）
- vehicles（車両：所有者IDを持つ）
- licenses（免許証）
- violations（違反記録）
- permits（許可証）

---

## バリデーション仕様

### 共通
- 必須項目未入力時はエラー
- 文字列最大長制限（氏名50文字、車両ナンバー20文字等）
- 日付はYYYY-MM-DD形式
- メールアドレスはRFC準拠
- IDは整数

### 各項目詳細
- 利用者
  - 氏名：必須、50文字以内
  - 連絡先：必須、メール形式
  - 権限区分："admin"または"user"
  - パスワード：必須、8文字以上、英数字混在
- 車両
  - 車両ナンバー：必須、20文字以内
  - 任意保険・車検期限：未来日
- 免許証
  - 免許証番号：必須、20文字以内
  - 有効期限：未来日
- 違反記録
  - 違反種別：必須、定義済み種別のみ
  - 発生日：過去日または当日
- 許可証
  - 許可証種別：必須、定義済み種別のみ
  - 有効期限：未来日
- CSVインポート
  - ファイル形式：UTF-8、ヘッダ行必須
  - 各行ごとに上記バリデーションを適用

---

## セキュリティ・運用

- パスワードはハッシュ化保存
- JWT等のトークン認証
- 操作ログ記録（ユーザーID、操作内容、日時）
- SQLインジェクション・XSS等の対策
- DB定期バックアップ（夜間自動）
- 操作ログ保存期間：1年以上
- セッションタイムアウト：30分

---

## CSVフォーマット例

- システム利用者：`name,company,email,role`
- 車両所有者：`owner_name,owner_license`  ※owner_licenseは免許期限
- 車両：`car_owner_id,user_id,number,type,insurance_exp,inspection_exp`
- 違反：`user_id,vehicle_id,type,date`

---

## 注意文書テンプレート例

- 違反種別ごとにテンプレートを用意
- 差し込み項目：利用者名、違反日、違反内容、累積違反数など

---

## その他

- 画面デザインはレスポンシブ（PC・タブレット対応）
- 操作ログは管理者のみ参照可
- APIエラー時はHTTPステータス＋エラー詳細をJSONで返却

---

## 今後の拡張案

- モバイル対応
- QRコードによる許可証管理
- 駐車場利用状況のリアルタイム表示

---

## ドキュメント・運用

詳細な画面モックアップ、ER図、APIレスポンス例、運用フロー、管理者マニュアル等は別途資料化  
ご要望に応じて追加ドキュメント作成可能

---

## お問い合わせ
システムの詳細・運用・拡張要望等はシステム管理者までご連絡ください。

---
